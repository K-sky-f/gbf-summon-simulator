<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>グラブル TA率計算ツール</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 20px; background-color: #f0f2f5; color: #333; }
        .container { max-width: 800px; margin: auto; background: #fff; padding: 25px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #d63384; margin-bottom: 20px; }
        .section-title { font-size: 1.2em; color: #495057; border-bottom: 2px solid #e9ecef; padding-bottom: 5px; margin-top: 25px; margin-bottom: 15px; }
        .input-group { display: flex; align-items: center; margin-bottom: 15px; }
        .input-group label { min-width: 150px; font-weight: 600; color: #555; }
        .input-group input[type="number"] { flex-grow: 1; padding: 8px; border: 1px solid #ccc; border-radius: 6px; margin-right: 10px; }
        .input-group .btn-group { display: flex; flex-wrap: wrap; gap: 5px; }
        .input-group button { padding: 8px 12px; border: none; border-radius: 6px; cursor: pointer; background-color: #007bff; color: white; transition: background-color 0.3s; white-space: nowrap; }
        .input-group button.reset-btn { background-color: #dc3545; }
        .input-group button.reset-btn:hover { background-color: #c82333; }
        .input-group button:hover { background-color: #0056b3; }
        .input-group button:disabled { background-color: #ccc; cursor: not-allowed; }
        #totalResult { margin-top: 30px; padding: 20px; border: 2px solid #28a745; border-radius: 8px; background-color: #e2f9e4; text-align: center; font-size: 1.5em; font-weight: bold; color: #28a745; }
    </style>
</head>
<body>

<div class="container">
    <h1>グラブル TA率計算ツール</h1>
    <div style="text-align: right; margin-bottom: 20px;">
        <button onclick="resetCalculator()" class="reset-btn">リセット</button>
    </div>

    <div class="section-title">基礎TA率</div>
    <div class="input-group">
        <label for="baseTA">基礎TA率(神滅の印章込) (%):</label>
        <input type="number" id="baseTA" value="8.0">
    </div>

    <div class="section-title">加護</div>
    <div class="input-group">
        <label for="kamiKago">神石加護 (%):</label>
        <input type="number" id="kamiKago" value="0" min="0" max="500">
        <div class="btn-group">
            <button onclick="addKago('kamiKago', 150, 2)" id="kami150Btn">神石200</button>
            <button onclick="addKago('kamiKago', 160, 2)" id="kami160Btn">神石230</button>
            <button onclick="addKago('kamiKago', 170, 2)" id="kami170Btn">神石250</button>
        </div>
    </div>
    <div class="input-group">
        <label></label>
        <div class="btn-group">
            <button onclick="addKago('kamiKago', 40, 1)" id="rokuBtn">六竜石 +40</button>
            <button onclick="addKago('kamiKago', 30, 3)" id="boostBtn">ブースト武器 +30</button>
            <button onclick="addKago('kamiKago', 20, 1)" id="angelBtn">天使 +20</button>
        </div>
    </div>
    
    <div class="input-group">
        <label for="magnaKago">マグナ加護 (%):</label>
        <input type="number" id="magnaKago" value="0" min="0" max="500">
         <div class="btn-group">
            <button onclick="addKago('magnaKago', 140, 2)" id="magna140Btn">マグナ200</button>
            <button onclick="addKago('magnaKago', 150, 2)" id="magna150Btn">マグナ230</button>
            <button onclick="addKago('magnaKago', 160, 2)" id="magna160Btn">マグナ240</button>
            <button onclick="addKago('magnaKago', 170, 2)" id="magna170Btn">マグナ250</button>
        </div>
    </div>
    <div class="input-group">
        <label></label>
        <div class="btn-group">
            <button onclick="addKago('magnaKago', 30, 1)" id="kusabiBtn">楔石 +30</button>
            <button onclick="addKago('magnaKago', 10, 1)" id="fourBtn">四聖 +10</button>
        </div>
    </div>
    
    <div class="section-title">武器スキル TA率</div>
    <div class="input-group">
        <label for="kamiWeaponTA">神石対応TA率 (%):</label>
        <input type="number" id="kamiWeaponTA" value="0" max="75">
        <div class="btn-group">
            <button onclick="addWeaponTA('kamiWeaponTA', 2.0)">乱舞小 (+2.0)</button>
            <button onclick="addWeaponTA('kamiWeaponTA', 3.65)">乱舞中 (+3.65)</button>
            <button onclick="addWeaponTA('kamiWeaponTA', 3.5)">三手小 (+3.5)</button>
            <button onclick="addWeaponTA('kamiWeaponTA', 6.0)">三手中 (+6.0)</button>
            <button onclick="addWeaponTA('kamiWeaponTA', 7.0)">三手大 (+7.0)</button>
        </div>
    </div>
    <div class="input-group">
        <label for="magnaWeaponTA">マグナ対応TA率 (%):</label>
        <input type="number" id="magnaWeaponTA" value="0">
        <div class="btn-group">
            <button onclick="addWeaponTA('magnaWeaponTA', 2.0)">乱舞小 (+2.0)</button>
            <button onclick="addWeaponTA('magnaWeaponTA', 3.65)">乱舞中 (+3.65)</button>
            <button onclick="addWeaponTA('magnaWeaponTA', 3.5)">三手小 (+3.5)</button>
            <button onclick="addWeaponTA('magnaWeaponTA', 6.0)">三手中 (+6.0)</button>
            <button onclick="addWeaponTA('magnaWeaponTA', 7.0)">三手大 (+7.0)</button>
        </div>
    </div>

    <div class="section-title">特殊武器・召喚石</div>
    <div class="input-group">
        <label for="kyokuseikiTA">極星器TA率 (%):</label>
        <input type="number" id="kyokuseikiTA" value="0">
        <div class="btn-group">
            <button onclick="setWeaponTA('kyokuseikiTA', 0)">なし (0%)</button>
            <button onclick="setWeaponTA('kyokuseikiTA', 5)">不一致 (5%)</button>
            <button onclick="setWeaponTA('kyokuseikiTA', 10)">一致 (10%)</button>
        </div>
    </div>
    <div class="input-group">
        <label for="shumatsuTA">終末210以上通常TA率 (%):</label>
        <input type="number" id="shumatsuTA" value="0">
        <div class="btn-group">
            <button onclick="setWeaponTA('shumatsuTA', 0)">なし (0%)</button>
            <button onclick="setWeaponTA('shumatsuTA', 2.5)">220 (2.5%)</button>
            <button onclick="setWeaponTA('shumatsuTA', 5.0)">240 (5.0%)</button>
        </div>
    </div>
    <div class="input-group">
        <label for="atosTA">アトスTA率 (%):</label>
        <input type="number" id="atosTA" value="0" readonly>
        <button onclick="calculateAtosBonus()">アトス計算</button>
    </div>
    <div class="input-group">
        <label for="omegaTA">オメガ闘争TA率 (%):</label>
        <input type="number" id="omegaTA" value="0">
        <div class="btn-group">
            <button onclick="setWeaponTA('omegaTA', 0)">なし (0%)</button>
            <button onclick="setWeaponTA('omegaTA', 25.0)">あり (25%)</button>
        </div>
    </div>
    <div class="input-group">
        <label for="summonTA">召喚石 (%):</label>
        <input type="number" id="summonTA" value="0">
        <div class="btn-group">
            <button onclick="addSummonBonus(25, 2)" id="kaguyaBtn">メイン、フレカグヤ (+25%)</button>
            <button onclick="addSummonBonus(50, 1)" id="kaguyaBtn">メインバブ (主人公のみ+50%)</button>
            <button onclick="addSummonBonus(10, 1)" id="halmalBtn">サブハルマル (+10%)</button>
        </div>
    </div>
    
    <div class="section-title">バフ・LB・AF</div>
    <div class="input-group">
        <label for="charBuffTA">バフTA率 (%):</label>
        <input type="number" id="charBuffTA" value="0">
        <div class="btn-group">
            <button onclick="addCharBonus(25)" id="yuvakuBtn">誘惑 (+25%)</button>
        </div>
    </div>
    <div class="input-group">
        <label for="lbAfTA">LB/指輪/AF (%):</label>
        <input type="number" id="lbAfTA" value="0">
    </div>

    <button onclick="calculateTotalTA()">全TA率を計算</button>
    
    <div id="totalResult">
        合計TA率: 0.00%
    </div>
</div>

<script>
    const clickCounters = {
        kamiKago: { 150: 0, 160: 0, 170: 0 },
        magnaKago: { 140: 0, 150: 0, 160: 0, 170: 0 },
        etc: { 'rokuBtn': 0, 'boostBtn': 0, 'angelBtn': 0, 'kusabiBtn': 0, 'fourBtn': 0, 'kaguyaBtn': 0, 'halmalBtn': 0 }
    };

    const initialValues = {
        baseTA: 8.0,
        kamiKago: 0,
        magnaKago: 0,
        kamiWeaponTA: 0,
        magnaWeaponTA: 0,
        kyokuseikiTA: 0,
        shumatsuTA: 0,
        omegaTA: 0,
        summonTA: 0,
        charBuffTA: 0,
        lbAfTA: 0,
        atosTA: 0
    };

    function resetCalculator() {
        for (const id in initialValues) {
            document.getElementById(id).value = initialValues[id];
        }
        for (const category in clickCounters) {
            for (const key in clickCounters[category]) {
                clickCounters[category][key] = 0;
            }
        }
        document.getElementById('totalResult').innerText = `合計TA率: 0.00%`;
    }

    function addKago(inputId, valueToAdd, maxClicks) {
        const inputElement = document.getElementById(inputId);
        let currentValue = parseFloat(inputElement.value);

        let buttonId = '';
        if (inputId === 'kamiKago') {
            buttonId = 'kami' + valueToAdd + 'Btn';
        } else if (inputId === 'magnaKago') {
            buttonId = 'magna' + valueToAdd + 'Btn';
        } else {
            const allButtons = document.querySelectorAll('button');
            for (const button of allButtons) {
                if (button.textContent.includes(valueToAdd) && button.onclick.toString().includes(inputId)) {
                    buttonId = button.id;
                    break;
                }
            }
        }

        let counterKey = buttonId;
        if (inputId === 'kamiKago' && (valueToAdd === 150 || valueToAdd === 160 || valueToAdd === 170)) {
            const currentTotalKami = clickCounters.kamiKago[150] + clickCounters.kamiKago[160] + clickCounters.kamiKago[170];
            if (currentTotalKami >= maxClicks) {
                alert(`メインフレ神石ボタンは合計${maxClicks}回までしか押せません。`);
                return;
            }
            clickCounters.kamiKago[valueToAdd]++;
        } else if (inputId === 'magnaKago' && (valueToAdd === 140 || valueToAdd === 150 || valueToAdd === 160 || valueToAdd === 170)) {
            const currentTotalMagna = clickCounters.magnaKago[140] + clickCounters.magnaKago[150] + clickCounters.magnaKago[160] + clickCounters.magnaKago[170];
            if (currentTotalMagna >= maxClicks) {
                alert(`メインフレマグナボタンは合計${maxClicks}回までしか押せません。`);
                return;
            }
            clickCounters.magnaKago[valueToAdd]++;
        } else {
            if (clickCounters.etc[counterKey] >= maxClicks) {
                alert(`このボタンは${maxClicks}回までしか押せません。`);
                return;
            }
            clickCounters.etc[counterKey]++;
        }

        inputElement.value = Math.min(currentValue + valueToAdd, 500);
    }
    
    function addWeaponTA(inputId, value) {
        const inputElement = document.getElementById(inputId);
        let currentValue = parseFloat(inputElement.value) || 0;
        inputElement.value = currentValue + value;
    }
    
    function setWeaponTA(inputId, value) {
        document.getElementById(inputId).value = value;
    }

    function addSummonBonus(valueToAdd, maxClicks) {
        const inputElement = document.getElementById('summonTA');
        let currentValue = parseFloat(inputElement.value) || 0;
        
        let buttonId = (valueToAdd === 25) ? 'kaguyaBtn' : 'halmalBtn';
        
        if (clickCounters.etc[buttonId] >= maxClicks) {
            alert(`このボタンは${maxClicks}回までしか押せません。`);
            return;
        }
        clickCounters.etc[buttonId]++;
        inputElement.value = currentValue + valueToAdd;
    }

    function addCharBonus(valueToAdd) {
        const inputElement = document.getElementById('charBuffTA');
        let currentValue = parseFloat(inputElement.value) || 0;
        inputElement.value = currentValue + valueToAdd;
    }

    function calculateAtosBonus() {
    const kamiKago = parseFloat(document.getElementById('kamiKago').value) || 0;
    const magnaKago = parseFloat(document.getElementById('magnaKago').value) || 0;
    const totalKago = kamiKago + magnaKago;
    const atosInput = document.getElementById('atosTA');
    
    let currentValue = parseFloat(atosInput.value) || 0;
    let valueToAdd = 0;
    
    if (totalKago < 280) {
        valueToAdd = 6.25;
    } else {
        valueToAdd = 12.5;
    }
    
    atosInput.value = currentValue + valueToAdd;
    }

    function calculateTotalTA() {
        const baseTA = parseFloat(document.getElementById('baseTA').value) || 0;
        const kamiWeaponTA = parseFloat(document.getElementById('kamiWeaponTA').value) || 0;
        const magnaWeaponTA = parseFloat(document.getElementById('magnaWeaponTA').value) || 0;
        const kyokuseikiTA = parseFloat(document.getElementById('kyokuseikiTA').value) || 0;
        const shumatsuTA = parseFloat(document.getElementById('shumatsuTA').value) || 0;
        const omegaTA = parseFloat(document.getElementById('omegaTA').value) || 0;
        const summonTA = parseFloat(document.getElementById('summonTA').value) || 0;
        const charBuffTA = parseFloat(document.getElementById('charBuffTA').value) || 0;
        const lbAfTA = parseFloat(document.getElementById('lbAfTA').value) || 0;
        const atosTA = parseFloat(document.getElementById('atosTA').value) || 0;

        const kamiKago = parseFloat(document.getElementById('kamiKago').value) || 0;
        const magnaKago = parseFloat(document.getElementById('magnaKago').value) || 0;

        const finalKamiTA = kamiWeaponTA * (1 + kamiKago / 100);
        const finalMagnaTA = magnaWeaponTA * (1 + magnaKago / 100);

        const totalTA = baseTA + finalKamiTA + finalMagnaTA + kyokuseikiTA + shumatsuTA + omegaTA + summonTA + charBuffTA + lbAfTA + atosTA;

        document.getElementById('totalResult').innerText = `合計TA率: ${totalTA.toFixed(2)}%`;
    }
</script>

</body>

</html>
